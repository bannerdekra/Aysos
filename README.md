# 版本号 V1.0.4
# Agent 项目

这是一个包含开发工具的个人助手项目，支持 Deepseek、Gemini 等多模型，自动代理穿透防火墙，气泡布局自适应，支持多模态文件上传（图片、PDF、视频）。

# 开发准则（暂）

1.所有代码操作都必须写进日志文件夹 LOG（每日或每提交写一次），撰写LOG格式：时间+进度+其他（比如接下来的工作的实现方向，可不写）
LOG 例子：
2025.9.27
（1）.实现功能深色模式
（2）.实现根据系统时间自动切换深色模式
其他：讨论添加新功能

2.所有代码新添加的功能脚本都需要在 README-项目结构 中写明作用（每日或每提交写一次）
3.使用文本开发工具撰写提示词，该工具有存档方便溯源（开发者本地保存）
4.有任何新方向均需要完成以下完整的开发链条：提出idea——阐述目的——讨论必要性——论述可行性（技术路线）——执行改动
5.无论是否完成开发工作每日必须存档提交，github库的存档是可以选择性删除的只是一个保存平台，方便取用最新的开发版本
6.不允许同时编辑项目！！！需沟通协商各自的开发时间，确保每一时刻只有一个人在编辑该项目，每次编辑开始时都应该pull或者clone仓库再开始开发，确保项目进度统一

## 项目结构（2025-10-10）

- `SoftWare/Script/` - 所有脚本文件
  - `main.py` - 主程序
  - `api_client.py` - AI API调用（支持 Gemini/DeepSeek，官方SDK集成）
  - `api_config.py` - API配置与自动代理设置
  - `chat_area.py` - 聊天区域，气泡布局优化，支持气泡删除，文件引用显示
  - `bubble_copy_handler.py` - 对话气泡复制与删除信号
  - `chat_ui.py` - 聊天界面UI
  - `database_manager.py` - 数据库/DSN管理
  - `dialogs.py` - 软件弹窗类
  - `file_manager.py` - 本地对话管理，支持消息删除
  - `gemini_context_manager.py` - Gemini上下文与文件上传管理，支持视频理解，仅限图片/PDF/视频
  - `input_bar.py` - 输入栏，支持多模态文件上传
  - `responsive_switch.py` - 响应式切换
  - `sidebar.py` - 任务管理栏
  - `storage_config.py` - DSN逻辑切换，支持文件存储删除
  - `test_attachment_recognition.py` - 附件识别测试
  - `theme_manager.py` - 主题管理
  - `theme_settings.json` - 主题配置
- `SoftWare/Image/` - 软件资源
  - `Backgroud/` - UI背景图片
  - `loading/` - Agent回答加载中GIF
- `SoftWare/Icon/` - 软件封装图标
- `TOOL/` - 开发工具与辅助脚本
  - `dev_notebook.py` - 开发记事本工具
  - `sentence/summary.md` - 更新内容摘要
  - `test_fixes.py` - 自动化修复测试
  - `test_file_upload.py` - 附件上传测试
- `LOG/` - 日志与说明
  - `UPDATE_2025-09-28.md` / `UPDATE_2025-09-30.md` / `UPDATE_2025-10-05.md` / `UPDATE_2025-10-08.md` / `UPDATE_2025-10-09.md` / `UPDATE_2025-10-10.md` - 每日更新日志
  - `README.md` - 发布说明
- `GEMINI_VIDEO_SUPPORT.md` - Gemini 视频理解功能文档
- `test_video_support.py` - 视频支持测试套件

## 功能特性（2025-10-10）

### 核心功能
- 支持多AI模型（Gemini/DeepSeek），可随时切换
- Gemini集成官方SDK，自动密钥管理，支持最新模型（gemini-2.5-flash）
- 聊天气泡自适应布局，内容包裹优先，最大宽度限制，换行撑满
- 自动代理配置，支持本地代理穿透防火墙
- 完善的配置诊断与修复脚本
- 详细的技术文档与更新日志
- 联网即可使用个人助手问答
- 本地保存对话记录不泄密
- 预设提示词提高问答效率
- 任务管理栏滚动播放任务名称
- UI界面可缩放至任意大小

### 多模态文件支持（2025-10-10 重大更新）
- **📸 图片支持**：JPEG, PNG, GIF, WebP, HEIC, HEIF
  - < 20MB：内嵌上传（快速响应）
  - ≥ 20MB：File API 上传（服务器保留48小时）
- **📄 PDF支持**：完整的PDF文档理解
  - < 20MB：内嵌上传
  - ≥ 20MB：File API 上传
- **🎬 视频支持**：MP4, MOV, MPEG, AVI, WebM
  - 所有视频强制使用 File API（无论大小）
  - 最大支持 2GB 视频文件
  - 服务器保留48小时，支持多轮对话引用
- **文件引用显示**：用户/Agent气泡底部显示附件文件名
- **双重验证**：扩展名 + MIME类型白名单双重检查
- **智能路由**：根据文件类型和大小自动选择最优上传方式

### 高级文本搜索功能（2025-10-05）
- 支持当前对话搜索和全局搜索
- 智能高亮显示：气泡背景高亮 + 关键词文本高亮（双重高亮）
- 搜索结果计数与导航："已查找到 X 处内容，现在显示的是 Y/X 处"
- 上一处/下一处快速导航按钮（找到2处及以上时自动显示）
- Ctrl+F 快捷键快速唤醒搜索对话框
- 搜索结果自动居中显示，3秒高亮后恢复
- 支持大小写不敏感匹配

## 未来开发计划

### 短期计划
- 加入其他AI模型（Claude, GPT-4等）
- 优化视频文件的上传进度显示
- 添加视频缩略图预览功能
- 支持音频文件上传与语音识别

### 中期计划
- 加入图像生成功能（DALL-E, Midjourney等）
- 加入音频生成功能（TTS, 音乐生成）
- 多模态文件混合分析优化
- 文件管理面板（查看已上传文件，管理生命周期）

### 长期计划
- 插件系统，支持第三方扩展
- 本地模型支持（Ollama等）
- 协作功能，多用户对话
- 移动端适配

## 📊 技术栈

- **前端框架**：PyQt6
- **AI SDK**：Google GenAI SDK, OpenAI SDK
- **数据库**：SQLite（本地）/ ODBC（远程）
- **多模态**：Gemini File API, Vision API
- **网络**：自动代理配置，gRPC 认证隔离
- **测试**：自动化测试套件

## 📝 更新日志

- **2025-10-10**：✨ Gemini 视频理解支持，文件类型重构（仅图片/PDF/视频），气泡文件引用显示
- **2025-10-09**：🔧 修复 Gemini 文件上传代理冲突
- **2025-10-08**：🐛 气泡布局修复，文件上传优化
- **2025-10-05**：🔍 高级文本搜索功能
- **2025-09-30**：🎨 气泡自适应布局优化
- **2025-09-28**：🌓 深色模式与主题管理

详见 `LOG/` 目录下的详细更新日志。

## 🤝 贡献指南

请遵循开发准则（见文档顶部），所有改动需要：
1. 记录到日志文件夹 LOG
2. 更新 README 项目结构
3. 完成开发链条：idea → 目的 → 必要性 → 可行性 → 执行
4. 每日存档提交到 GitHub
5. 协调开发时间，确保单人编辑

## 📧 联系方式

- GitHub: [bannerdekra/Aysos](https://github.com/bannerdekra/Aysos)
- Issues: 欢迎提交问题和建议

## 📄 许可证

本项目仅供学习和个人使用。