# 2025-09-30 更新内容总结

## 主要更新

### 1. Gemini API集成与模型切换
- 支持 Google GenAI SDK，自动从环境变量 `GEMINI_API_KEY` 获取密钥。
- 默认模型已切换为 `gemini-2.5-flash`，并彻底清理了所有旧模型引用（如 `gemini-1.5-flash-latest`、`gemini-2.0-flash`）。
- 配置文件结构统一，顶层和 providers 节点均同步为 `gemini-2.5-flash`。
- 增加诊断和修复脚本，确保配置一致性。
- API调用逻辑采用官方推荐格式：
  ```python
  from google import genai
  client = genai.Client()
  response = client.models.generate_content(model="gemini-2.5-flash", contents="...")
  ```

### 2. 聊天气泡布局优化
- 气泡内容容器 `QLabel` 启用 `setWordWrap(True)`。
- 气泡最大宽度限制为聊天区域宽度的60%，动态响应窗口缩放。
- 气泡 `sizePolicy` 设置为 `QSizePolicy.Preferred`，内容包裹优先，自动收缩。
- 换行文本特殊处理：包含 `\n` 时，气泡最小宽度强制为最大宽度的95%，实现“撑满”视觉效果。
- 所有相关方法（用户气泡、Agent气泡、历史气泡、resizeEvent）均已优化。

### 3. API代理设置
- `api_config.py` 顶部新增代理设置，自动将所有API请求通过本机 `127.0.0.1:7890` 端口代理。
- 支持主流代理软件（如V2Ray、Clash），实现自动越过防火墙。
- 代理环境变量覆盖所有常用变量（HTTP_PROXY/HTTPS_PROXY等）。

### 4. 测试与验证
- 新增 `test_improvements.py` 脚本，自动验证代理设置和气泡布局逻辑。
- 代理和布局测试均通过，功能实现稳定。
- 新增 `IMPROVEMENTS_SUMMARY.md` 详细技术说明。

## 项目结构（2025-09-30）

```
README.md
UPDATE_2025-09-30.md
IMPROVEMENTS_SUMMARY.md
SoftWare/
    Script/
        api_client.py
        api_config.py
        chat_area.py
        ...
    Image/
    Icon/
TOOL/
    dev_notebook.py
    sentence/
        summary.md
    ...
test_improvements.py
```

## 功能特性（2025-09-30）

- 支持多AI模型（Gemini/DeepSeek），可随时切换
- Gemini集成官方SDK，自动密钥管理，支持最新模型
- 聊天气泡自适应布局，内容包裹优先，最大宽度限制，换行撑满
- 自动代理配置，支持本地代理穿透防火墙
- 完善的配置诊断与修复脚本
- 详细的技术文档与更新日志
